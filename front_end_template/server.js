!function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/",o(o.s=14)}([function(e,t){e.exports=require("path")},function(e,t){e.exports=require("webpack")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("nconf")},function(e,t){e.exports=require("express-useragent")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("body-parser")},function(e,t,o){var r=o(0),n=o(1),s=o(13);e.exports={entry:{main:["webpack-hot-middleware/client?path=/__webpack_hmr&timeout=20000","./src/index.js"]},output:{path:r.join(__dirname,"dist"),publicPath:"/",filename:"[name].js"},mode:"development",target:"web",devtool:"#source-map",module:{rules:[{test:/\.js$/,exclude:/node_modules/,loader:"babel-loader"},{test:/\.html$/,use:[{loader:"html-loader"}]},{test:/\.(sa|sc|c)ss$/,use:["style-loader","css-loader","sass-loader"]},{test:/\.(png|svg|jpg|gif)$/,use:["file-loader"]}]},plugins:[new s({template:"./view/index.html",filename:"./index.html",excludeChunks:["server"]}),new n.HotModuleReplacementPlugin,new n.NoEmitOnErrorsPlugin]}},function(e,t){e.exports=require("request-promise")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("uuidv4")},function(e,t){e.exports=require("webpack-dev-middleware")},function(e,t){e.exports=require("webpack-hot-middleware")},function(e,t){e.exports=require("html-webpack-plugin")},function(e,t,o){"use strict";o.r(t);var r=o(0),n=o.n(r),s=o(2),i=o.n(s),a=o(1),u=o.n(a),c=o(3),l=o.n(c),d=o(4),p=o.n(d),f=o(5),g=o.n(f),m=o(6),b=o.n(m),h=(o(11),o(12),o(7)),v=o.n(h),x=o(8),_=o.n(x),k=o(9),w=o.n(k),y=o(10),j=function(e,t,o){e.authenticated=!(!e.cookies||!e.cookies.access_token);var r=e.useragent,n=r.isAuthoritative,s=r.browser,i=r.version,a=r.os,u=r.platform,c=r.source;console.log("@API",{cookies:e.cookies,originalUrl:e.originalUrl,headers:e.headers});var l=e.headers,d=(l.referer,l.target),p=void 0===d?"":d,f=l["csrf-token"];if(n&&"API"===p)if(e.authenticated||global.allow_routes.api.find(function(t){return e.originalUrl.includes(t)})){e.body.metadata&&Object.assign(e.body.metadata,{browser:s,version:i,os:a,platform:u,source:c,csrf:f,device_id:Object(y.uuid)()});var g=nconf.get(e.header("target"))+e.originalUrl,m=nconf.get("API_USERNAME")+":"+nconf.get("API_PASSWORD"),b="Basic "+new Buffer(m).toString("base64");console.log("request date:",(new Date).toISOString()),_()({method:e.method,body:e.body||{},uri:g,headers:{Authorization:b,"content-type":"application/json; charset=utf-8","access-token":e.cookies.access_token||"","csrf-token":""},json:!0}).then(function(e){!1===e.authenticated?t.clearCookie("access_token"):e.authenticated&&t.cookie("access_token",e.access_token,{httpOnly:!0,expires:new Date(w()().add(nconf.get("SESSION_EXPIRES"),"d"))}),console.log("response date:",(new Date).toISOString()),t.status(200).send(e)}).catch(function(e){500===e.statusCode?e.error.message="Server Error.":401===e.statusCode&&(t.clearCookie("_csrf"),t.clearCookie("access_token"),e.error={message:"Unauthorized.",redirect_url:"/login"}),t.status(e.statusCode).send(e.error)})}else t.status(401).send({message:"Session expired.",redirect_url:"/login"});else o();return!0};l.a.argv().env().add("global",{file:process.cwd()+"/config/production.json",type:"file"}),global.nconf=l.a,global.allow_routes={api:["user/login"],page:["/login","/reset-password"]};var S=i()(),q=__dirname,O=n.a.join(q,"/dist/index.html");u()(v.a);S.use(p.a.express()),S.use(g()()),S.use(b.a.json({type:"*/*",limit:"20mb"})),S.use(i.a.static(n.a.join(process.cwd(),"public"))),S.use(j),S.get("*",function(e,t,o){t.sendFile(O)});var P=process.env.PORT||3e3;S.listen(P,function(){console.log("App listening to ".concat(P,"....")),console.log("Press Ctrl+C to quit.")})}]);